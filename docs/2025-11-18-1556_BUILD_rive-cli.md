# Rive CLI - Product Requirements Document

## 1. Overview
A CLI tool to manage ephemeral review applications in git repositories, providing easy creation, management, and cleanup of temporary development environments.

## 2. Core Functionality

### 2.1 Create Review App
- Input: Git branch name
- Creates a git worktree for the specified branch
- Launches a local development server on an available port
- Configuration options via:
  - Environment variables
  - `.env` file in current working directory
  - Command-line flags (override precedence: CLI > .env > environment variables)

### 2.2 Port Management
- Automatically find first available port
- Default starting port: 40000
- Configurable port range via configuration
- Prevent port conflicts with existing review apps

## 3. Configuration Options

### 3.1 Environment Configuration
- `RIVE_START_PORT`: Starting port for server allocation
- `RIVE_WORKTREE_DIR`: Base directory for creating worktrees
- `RIVE_SERVER_COMMAND`: Server launch command with `%PORT%` placeholder
  - Example: `npm run start --port %PORT%`
- Configurable via:
  - `.env` file
  - Environment variables
  - CLI flags

## 4. Advanced Commands

### 4.1 List Command
- `rive list`
- Display all running review apps
- Information to show:
  - Branch name
  - Port number
  - Worktree location
  - Server status
  - Uptime

### 4.2 Stop Command
- `rive stop <branch-name or port>`
- Terminate specific review app
- Options:
  - Stop by branch name
  - Stop by port number
  - Stop all review apps

### 4.3 Restart Command
- `rive restart <branch-name or port>`
- Restart a specific review app
- Maintains same port and worktree

### 4.4 CD Command
- `rive cd <branch-name or port>`
- Change current shell directory to the review app's worktree
- Useful for quick access and debugging

## 5. Error Handling
- Detailed error messages
- Non-zero exit codes for script failures
- Graceful handling of:
  - Non-existent branches
  - Port allocation failures
  - Duplicate review apps

## 6. Technical Constraints
- Bash/POSIX script implementation
- Requires:
  - Git
  - lsof or equivalent port checking tool
  - Basic Unix utilities

## 7. Non-Goals
- Full replacement of existing deployment tools
- Complex orchestration
- Multi-service review environments
